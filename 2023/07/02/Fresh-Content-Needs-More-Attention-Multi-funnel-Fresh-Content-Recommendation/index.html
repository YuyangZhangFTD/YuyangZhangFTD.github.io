<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Recommendation System,Deep Learning,Fresh Content," />





  <link rel="alternate" href="/atom.xml" title="Arvin's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="æ‘˜è¦ Recommendation system serves as a conduit connecting users to an incredibly large, diverse and ever growing collection of contents. In practice, missing information on fresh (and tail) contents nee">
<meta property="og:type" content="article">
<meta property="og:title" content="Fresh Content Needs More Attention- Multi-funnel Fresh Content Recommendation">
<meta property="og:url" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/index.html">
<meta property="og:site_name" content="Arvin&#39;s Blog">
<meta property="og:description" content="æ‘˜è¦ Recommendation system serves as a conduit connecting users to an incredibly large, diverse and ever growing collection of contents. In practice, missing information on fresh (and tail) contents nee">
<meta property="og:locale">
<meta property="og:image" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/recommendation_stack.png">
<meta property="og:image" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/experiment_diagrams.png">
<meta property="og:image" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/exp1_1.png">
<meta property="og:image" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/exp1_2.png">
<meta property="og:image" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/real-time_model.png">
<meta property="og:image" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/multi-funnel_nomination.png">
<meta property="og:image" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/exp2_1.png">
<meta property="og:image" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/exp2_2.png">
<meta property="article:published_time" content="2023-07-02T02:47:37.000Z">
<meta property="article:modified_time" content="2023-07-02T02:54:46.960Z">
<meta property="article:author" content="YuyangZhangFTD">
<meta property="article:tag" content="Recommendation System">
<meta property="article:tag" content="Deep Learning">
<meta property="article:tag" content="Fresh Content">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/recommendation_stack.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/"/>





  <title>Fresh Content Needs More Attention- Multi-funnel Fresh Content Recommendation | Arvin's Blog</title>
  














<meta name="generator" content="Hexo 5.4.2"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Arvin's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Poem & Algorithm</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2023/07/02/Fresh-Content-Needs-More-Attention-Multi-funnel-Fresh-Content-Recommendation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Arvin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Fresh Content Needs More Attention- Multi-funnel Fresh Content Recommendation</h1>
        

        <div class="post-meta">
          

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2023-07-02T10:47:37+08:00">
                2023-07-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PaperNote/" itemprop="url" rel="index">
                    <span itemprop="name">PaperNote</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h1><blockquote>
<p>Recommendation system serves as a conduit connecting users to an incredibly large, diverse and ever growing collection of contents. In practice, missing information on fresh (and tail) contents needs to be filled in order for them to be exposed and discovered by their audi- ence. We here share our success stories in building a dedicated fresh content recommendation stack on a large commercial platform. To nominate fresh contents, we built a multi-funnel nomination sys- tem that combines (i) a two-tower model with strong generalization power for coverage, and (ii) a sequence model with near real-time update on user feedback for relevance. The multi-funnel setup ef- fectively balances between coverage and relevance. An in-depth study uncovers the relationship between user activity level and their proximity toward fresh contents, which further motivates a contextual multi-funnel setup. Nominated fresh candidates are then scored and ranked by systems considering prediction uncertainty to further bootstrap content with less exposure. We evaluate the benefits of the dedicated fresh content recommendation stack, and the multi-funnel nomination system in particular, through user corpus co-diverted live experiments. We conduct multiple rounds of live experiments on a commercial platform serving billion of users demonstrating efficacy of our proposed methods.</p>
</blockquote>
<p>æ¨èç³»ç»Ÿæ˜¯ä¸€ä¸ªèƒ½å¤Ÿå°†ç”¨æˆ·å’Œä¸æ–­å¢é•¿çš„å¤šæ ·å†…å®¹ç›¸äº’è”ç³»çš„æ¸ é“ï¼Œåœ¨å®è·µä¸­ï¼Œæ–°å†…å®¹ï¼ˆä»¥åŠé•¿å°¾çš„å†…å®¹ï¼‰éœ€è¦å¡«è¡¥ä¿¡æ¯æ‰èƒ½æ‰¾åˆ°å¯¹åº”çš„å—ä¼—ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦åˆ†äº«äº†æˆ‘ä»¬åœ¨youtubeï¼ˆä¸€ä¸ªå¤§å‹å•†ä¸šå¹³å°ï¼‰ä¸Šé’ˆå¯¹æ–°å†…å®¹æ‰€æ­å»ºæ¨èé“¾è·¯çš„æˆåŠŸç»å†ã€‚ä¸ºäº†å­µåŒ–æ–°å†…å®¹ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå¤šé€šé“çš„â€œæåâ€ç³»ç»Ÿï¼ˆå¬å›ï¼‰ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>ä¸ºäº†æå‡è¦†ç›–åº¦ï¼Œå…·å¤‡æå¼ºæ³›åŒ–èƒ½åŠ›çš„åŒå¡”æ¨¡å‹</li>
<li>ä¸ºäº†æå‡ç›¸å…³æ€§ï¼ˆå¯ä»¥ç†è§£ä¸ºç”¨æˆ·å¯¹å†…å®¹å–œçˆ±ç¨‹åº¦ï¼‰ï¼Œæ ¹æ®ç”¨æˆ·è¡Œä¸ºï¼Œè¿‘å®æ—¶æ›´æ–°çš„åºåˆ—æ¨¡å‹</li>
</ol>
<p>å¤šé€šé“çš„è®¾è®¡ä¹Ÿèƒ½å¤Ÿæœ‰æ•ˆå¹³è¡¡è¦†ç›–åº¦å’Œç›¸å…³æ€§ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œé€šè¿‡ä¸€é¡¹ç ”ç©¶ï¼Œæˆ‘ä»¬ä¹Ÿå‘ç°ç”¨æˆ·çš„æ´»è·ƒåº¦å’Œä»–ä»¬å¯¹äºæ–°å†…å®¹çš„æ¥è¿‘ç¨‹åº¦æœ‰å…³ï¼Œè¿™ä¹Ÿä¿ƒä½¿æˆ‘ä»¬é‡‡ç”¨å¤šé€šé“çš„æ–¹å¼ã€‚</p>
<p>è¢«æåçš„æ–°å†…å®¹ä¹‹åä¼šç”±è€ƒè™‘åˆ°é¢„æµ‹ä¸ç¡®å®šæ€§çš„ç³»ç»Ÿè¿›è¡Œæ‰“åˆ†å’Œæ’åï¼Œè¿›ä¸€æ­¥æå‡å°‘æ›å…‰çš„å†…å®¹ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ç”¨æˆ·å’Œå†…å®¹å…±åŒåˆ†æµçš„å®éªŒï¼Œè¯„ä¼°æ–°å†…å®¹å­µåŒ–é“¾è·¯ä»¥åŠå¤šé€šé“æåç³»ç»Ÿæ‰€å¸¦æ¥çš„æ”¶ç›Šï¼Œå¹¶åœ¨ä¸€ä¸ªä¸ºåäº¿ç”¨æˆ·æœåŠ¡çš„å•†ä¸šå¹³å°ä¸Šè¿›è¡Œäº†å¤šè½®å®éªŒï¼Œè¯æ˜äº†æˆ‘ä»¬çš„æ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚</p>
<h1 id="æ–°å†…å®¹å­µåŒ–é“¾è·¯"><a href="#æ–°å†…å®¹å­µåŒ–é“¾è·¯" class="headerlink" title="æ–°å†…å®¹å­µåŒ–é“¾è·¯"></a>æ–°å†…å®¹å­µåŒ–é“¾è·¯</h1><p><img src="./recommendation_stack.png" alt="recommendation stack"></p>
<p>æ•´ä½“é“¾è·¯å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š</p>
<p><strong>1. æ–°å†…å®¹æå</strong>ï¼šå¯¹äºæ–°å†…å®¹æåæ¨¡å—ï¼Œå…¶ä¸»è¦æŒ‘æˆ˜å°±æ˜¯ç¼ºå°‘ç”¨æˆ·äº¤äº’ä¿¡æ¯ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªå†·å¯åŠ¨é—®é¢˜ï¼Œé‡‡ç”¨äº†åŸºäºå†…å®¹çš„åŒå¡”æ¨¡å‹ï¼Œé€šè¿‡itemç‰¹å¾å¯ä»¥å…·å¤‡è¾ƒå¥½çš„æ³›åŒ–èƒ½åŠ›ï¼Œçº¿ä¸Šinferenceæ—¶é‡‡ç”¨æœ€å¤§å†…ç§¯æœç´¢ï¼Œæ£€ç´¢å‡ºtop 50çš„å†…å®¹ã€‚</p>
<p><strong>2. æ¯•ä¸šè¿‡æ»¤</strong>ï¼šä¸€æ—¦æ–°å†…å®¹å®Œæˆåˆå§‹çš„ç”¨æˆ·äº¤äº’ç§¯ç´¯ï¼Œå®ƒä»¬å°±å¯ä»¥è¢«æ¨èçš„ä¸»é€šé“æ‰€å¬å›ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„è‡³å°‘è¿‡æ»¤æ¡ä»¶ä¸ºè‡³å°‘è¢«ç”¨æˆ·æ¶ˆè´¹næ¬¡ï¼Œå…¶ä¸­næ˜¯æ ¹æ®èƒ½å¤Ÿè¢«æ¨èä¸»èµ›é“è¿›è¡Œæœ‰æ•ˆåˆ†å‘çš„æ­£äº¤äº’æ•°é‡ç¡®å®šçš„ã€‚</p>
<p><strong>3. æ’åº</strong>ï¼šæ’åºåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå®æ—¶çš„ç²—æ’ï¼ˆpre-scorerï¼Œé¢„æ’åºï¼‰å’Œä¸»èµ›é“çš„ç²¾æ’ï¼Œå…¶ä¸­ç²—æ’ç›¸å¯¹è½»é‡çº§ï¼Œå¯ä»¥å®æ—¶ååº”ç”¨æˆ·çš„æ—©æœŸè¡Œä¸ºï¼Œç²—æ’é€‰å‡ºtop 10è¿›å…¥ç²¾æ’ï¼Œç„¶åç²¾æ’é€‰å‡ºtop 1ã€‚</p>
<p>ç²—æ’ä¸­åŒ…å«ä¸€ä¸ªå®æ—¶çš„Bernoulli multi-arm banditï¼Œå¯¹æ¯æ¡å†…å®¹è¿›è¡ŒE&amp;Eï¼Œä¼°è®¡Good CTRï¼ˆç‚¹å‡»ååœç•™10sä»¥ä¸Šï¼‰ï¼Œ$r_i \sim \text{Beta}(\alpha_0 + x_i,\beta_0+n_i-x_i)$ï¼Œå…¶ä¸­$\alpha_0,\beta_0$ä¸ºå…¨å±€çš„å…ˆéªŒç»Ÿè®¡ï¼ˆåªç»Ÿè®¡100PVä»¥ä¸Šçš„å†…å®¹ï¼‰ï¼Œçº¿ä¸Šä½¿ç”¨æ—¶ï¼Œé‡‡ç”¨Thompsoné‡‡æ ·ï¼Œé€‰æ‹©top 10å†…å®¹ã€‚</p>
<p><strong>4. å®šå‘</strong>ï¼šå®šå‘çš„åšæ³•å¯èƒ½ä¼šæœ‰æŸæ•ˆç‡ï¼Œä½†æ˜¯ä¼šæœ‰è¿™æ ·å‡ ä¸ªä¼˜åŠ¿ï¼Œé¦–å…ˆæ›´å¯æ§ï¼Œæœ‰ç¨³å®šçš„æµé‡åˆ†é…ç»™è¯¥æ–°å†…å®¹ï¼Œå—åˆ°æµè¡Œåº¦biasï¼ˆå³é©¬å¤ªæ•ˆåº”ï¼Œå‘å¤´éƒ¨é›†ä¸­ï¼‰å½±å“æ›´å°ï¼ŒåŒæ—¶æ˜“åº¦é‡ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°æ¯”è¾ƒä¸åŒç­–ç•¥çš„å¥½åï¼Œä»¥åŠå¯æ‰©å±•æ€§å¼ºï¼Œå¯ä»¥é€šè¿‡æ‰©å‘çš„æ–¹å¼æå‡å­µåŒ–å†…å®¹æ•°é‡ã€‚</p>
<p>å¯ä»¥å‡ºç°åœ¨å®šå‘çš„æ–°å†…å®¹å®šä¹‰ä¸ºXå¤©å†…å‘å¸ƒä¸”æ­£å‘ç”¨æˆ·äº¤äº’æ•°ä½äºYçš„å†…å®¹ã€‚</p>
<p><img src="./experiment_diagrams.png" alt="experiment_diagrams"></p>
<p><strong>ç”¨æˆ·-å†…å®¹å…±åŒåˆ†æµå®éªŒ</strong>ï¼Œç›¸æ¯”äºä¼ ç»ŸABå®éªŒï¼Œå†…å®¹ä¼šå±•ç¤ºç»™ä¸åŒç»„çš„ç”¨æˆ·ï¼Œæ— æ³•è§‚æµ‹ç­–ç•¥å¯¹äºå†…å®¹çš„å½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ç”¨æˆ·-å†…å®¹å…±åŒåˆ†æµçš„å®éªŒæ–¹å¼ï¼Œç”¨æˆ·å’Œå†…å®¹åˆ†æµç›¸åŒçš„æ¯”ä¾‹æ‰€å¾—åˆ°çš„å®éªŒç»“æœä¸å…¨é‡åå¤§ç›˜æ•ˆæœæ˜¯ä¸€è‡´çš„ã€‚</p>
<p><strong>è¯„ä¼°æŒ‡æ ‡</strong>ï¼š</p>
<ol>
<li>Daily Unique Impressed Contents at ğ¾ (DUIC@K) ï¼Œå†…å®¹æµé‡æŒ‡æ ‡ï¼Œä¸åŒæ›å…‰æ•°é‡ä¸‹çš„å†…å®¹æ•°ï¼Œç”¨äºè¡¡é‡è¦†ç›–åº¦çš„å˜åŒ–</li>
<li>Fresh Content Dwell Time (DwellTime) ï¼Œç”¨æˆ·æŒ‡æ ‡ï¼Œæ–°å†…å®¹çš„è§‚çœ‹æ—¶é•¿ï¼Œç”¨äºåº¦é‡ç›¸å…³æ€§</li>
<li>Number of content receiving X (post bootstrapping) posi- tive interactions in Y days (Discoverable Corpus@X,Ydays)ï¼Œç”¨äºåº¦é‡å®éªŒåçš„é•¿æœŸæ”¶ç›Šï¼ŒYå¤©å†…è·å¾—Xæ¬¡æ­£å‘æ•ˆæœçš„å†…å®¹æ•°é‡</li>
</ol>
<p>ä½œè€…ä»¬åšäº†ä¸ºæœŸä¸€ä¸ªæœˆçš„ç”¨æˆ·-å†…å®¹åˆ†æµå®éªŒï¼Œç”¨äºè¯„ä¼°æ–°å†…å®¹å­µåŒ–é“¾è·¯çš„ä»·å€¼ï¼š</p>
<ol>
<li>è¦†ç›–åº¦æå‡äº†ï¼Œfig4(a)ä¸ºä¸åŒæ›å…‰æ•°ï¼ˆKï¼‰ä¸‹ï¼Œå†…å®¹çš„æ•°é‡æœ‰4% âˆ¼ 7.2%çš„å¢é•¿</li>
<li>æ›´å¤šå†…å®¹è¢«ç”¨æˆ·æ¶ˆè´¹äº†ï¼Œfig4(b)ä¸­ï¼Œæ¨ªè½´æ˜¯åŠ©æ¨åå†…å®¹å—åˆ°æ­£å‘äº¤äº’çš„æ•°é‡ï¼Œçºµè½´æ˜¯ä¸åŒç»Ÿè®¡å‘¨æœŸå†…çš„å†…å®¹æ•°é‡ï¼Œç›¸æ¯”å¯¹ç…§ç»„ï¼Œå­µåŒ–åŠ©æ¨ä¼šè®©æ–°å†…å®¹åœ¨ä¹‹åè·å¾—æ›´å¤šç”¨æˆ·çš„äº¤äº’ï¼Œè¿™ä¹Ÿè¡¨æ˜æ–°å†…å®¹å­µåŒ–é“¾è·¯ä¸ä»…æé«˜äº†å†…å®¹çš„è¦†ç›–åº¦ï¼Œä¹Ÿå¯¹æœ‰ä»·å€¼çš„å†…å®¹æœ‰é•¿æœŸçš„åŠ©åŠ›ä½œç”¨</li>
<li>åˆ›ä½œè€…å—åˆ°æ¿€åŠ±åˆ›ä½œäº†æ›´å¤šå†…å®¹ï¼Œfig4(c)ä¸­ï¼Œåˆ›ä½œè€…ä¸Šä¼ å†…å®¹æ•°é‡éšç€æ—¶é—´ä¹Ÿé€’å¢</li>
<li>æ›´å¤šæ–°å†…å®¹è¢«ç”¨æˆ·æ¶ˆè´¹çš„åŒæ—¶ï¼ŒçŸ­æœŸç”¨æˆ·å‚ä¸åº¦çš„å½±å“å¾ˆä½ï¼Œfig5(a)ç”¨æˆ·å¯¹äºæ–°å†…å®¹çš„äº¤äº’æ•°é‡å¢åŠ äº†+2.52%ï¼Œåœç•™æ—¶é•¿é™ä½äº†-0.12%ï¼Œä¸­å°åˆ›ä½œè€…çš„åœç•™æ—¶é•¿å¢åŠ +5.5%</li>
</ol>
<p><img src="./exp1_1.png" alt="exp1_1"></p>
<p><img src="./exp1_2.png" alt="exp1_2"></p>
<h1 id="å¤šé€šé“æ–°å†…å®¹æ¨è"><a href="#å¤šé€šé“æ–°å†…å®¹æ¨è" class="headerlink" title="å¤šé€šé“æ–°å†…å®¹æ¨è"></a>å¤šé€šé“æ–°å†…å®¹æ¨è</h1><p>åœ¨æœ‰åŸºç¡€é“¾è·¯ä¹‹åï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨æœ‰é™æ•°æ®çš„å¸®åŠ©ä¸‹å°½é‡æé«˜æ‰€å­µåŒ–å†…å®¹çš„ç›¸å…³æ€§ï¼Œæ‰€ä»¥æå‡ºä¸€ä¸ªå¤šé€šé“çš„å¬å›æ–¹æ¡ˆã€‚</p>
<h2 id="å†…å®¹æ³›åŒ–"><a href="#å†…å®¹æ³›åŒ–" class="headerlink" title="å†…å®¹æ³›åŒ–"></a>å†…å®¹æ³›åŒ–</h2><p>å¤§éƒ¨åˆ†åŸºäºååŒè¿‡æ»¤çš„æ¨èæ¨¡å‹æ˜¯æ ¹æ®ç”¨æˆ·çš„è¡Œä¸ºæˆ–è¯„åˆ†ï¼Œæ¥æ„å»ºç”¨æˆ·å’Œå†…å®¹çš„id embeddingï¼Œä½†æ˜¯é•¿å°¾å†…å®¹ã€æ–°å‘å¸ƒå†…å®¹å¤©ç„¶ä¼šç¼ºå°‘ç”¨æˆ·çš„äº¤äº’ï¼Œè¿™ä¹Ÿä½¿å¾—æ¨¡å‹æ— æ³•å­¦å¥½id embeddingã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªå¯è¡Œçš„è§£æ³•æ˜¯æ ¹æ®åˆ›ä½œè€…è¿›è¡Œæ¨èï¼Œå°†æ–°å†…å®¹åˆ†å‘ç»™ç†Ÿæ‚‰çš„æˆ–è€…å·²ç»è®¢é˜…çš„ç”¨æˆ·ã€‚</p>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬æ ¹æ®å†…å®¹ç‰¹å¾æ¥æè¿°æ–°å‘å¸ƒå†…å®¹ï¼Œè¿™ç±»ç‰¹å¾å¯ä»¥ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿå€Ÿçƒ­é—¨æµè¡Œå†…å®¹å­¦ä¹ åˆ°é’ˆå¯¹æ–°å†…å®¹çš„ç”¨æˆ·åå¥½ã€‚åœ¨åŸå§‹åŒå¡”æ¨¡å‹ç»“æ„çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å»æ‰äº†idç±»ç‰¹å¾ã€å†…å®¹å†å²è¡Œä¸ºç»Ÿè®¡ç±»ç‰¹å¾ã€‚</p>
<h2 id="å®æ—¶å­¦ä¹ "><a href="#å®æ—¶å­¦ä¹ " class="headerlink" title="å®æ—¶å­¦ä¹ "></a>å®æ—¶å­¦ä¹ </h2><p>åœ¨æœ‰è¾ƒå¼ºå†…å®¹æ³›åŒ–èƒ½åŠ›åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨ç”¨æˆ·çš„ç¨€ç–è¡Œä¸ºæ¥æå‡ç³»ç»Ÿçš„ç›¸å…³æ€§ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åšäº†ä¸€ä¸ªè¿‘å®æ—¶æ›´æ–°çš„æåç³»ç»Ÿï¼Œé‡‡ç”¨å®æ—¶ç”¨æˆ·è¡Œä¸ºæ•°æ®è¿›è¡Œè®­ç»ƒï¼ŒåŒæ—¶æ„å»ºäº†ä¸€ä¸ªä½å»¶è¿Ÿçš„ä¸ªæ€§åŒ–å¬å›æ¨¡å‹ã€‚</p>
<p>æ¨¡å‹çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œitemå¡”ä»…é‡‡ç”¨id embeedingï¼Œuserå¡”ç”±ç”¨æˆ·åŸºæœ¬ç‰¹å¾embeddingå’Œç”¨æˆ·æ‰€æ¶ˆè´¹çš„è¡Œä¸ºåºåˆ—æ„æˆï¼Œè¡Œä¸ºåºåˆ—ç”¨attentionçš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œattentionçš„æƒé‡å’Œå¯¹åº”å†…å®¹çš„åœç•™æ—¶é•¿ã€è§‚çœ‹åˆ°å½“å‰çš„æ—¶é—´é—´éš”ä»¥åŠæ›å…‰ä½ç½®ç›¸å…³ã€‚ä½œè€…æ›¾å°è¯•ä½¿ç”¨RNNç±»ç»“æ„ï¼Œä½†æ˜¯æ²¡æœ‰æ˜æ˜¾æ•ˆæœæå‡ã€‚æ¨¡å‹æ¯15minä¼šç”¨æœ€æ–°çš„æ•°æ®è®­ç»ƒä¸€å°æ—¶ï¼Œç„¶åæ¨¡å‹ä¸Šçº¿ï¼Œçº¿ä¸Šä»é‡‡ç”¨æœ€å¤§å†…ç§¯æ£€ç´¢ï¼Œå¹¶è¿”å›top 50çš„ç»“æœã€‚</p>
<p><img src="./real-time_model.png" alt="real-time_model"></p>
<p>åœ¨æ–°å†…å®¹ä¸Šçº¿çš„æ—¶å€™ï¼Œå†…å®¹çš„è¡¨ç°ä¼šæœ‰è¾ƒå¤§å·®å¼‚ï¼Œæœ‰çš„å†…å®¹ä¼šå¿«é€Ÿç§¯ç´¯æ•°åƒçš„äº¤äº’æ•°æ®ï¼Œæœ‰çš„å´å¾ˆç¨€ç–ã€‚ç”±äºæ¨¡å‹ä»…ä¾èµ–äºid embeddingï¼Œè¿™å°±å¯¼è‡´å¯èƒ½ä¼šå­˜åœ¨æ¨¡å‹è¢«å°‘æ•°çˆ†ç«çš„å†…å®¹æ‰€domainçš„é£é™©ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¢åŠ äº†ä¸€äº›å†…å®¹å±æ€§ç‰¹å¾ï¼Œå¹¶ä¸”ç”¨IDFçš„æ–¹å¼è¿›è¡ŒåŠ æƒï¼Œæ¥é¿å…æµè¡Œçƒ­é—¨å†…å®¹å±æ€§çš„å½±å“ã€‚</p>
<h2 id="å¤šé€šé“å¬å›"><a href="#å¤šé€šé“å¬å›" class="headerlink" title="å¤šé€šé“å¬å›"></a>å¤šé€šé“å¬å›</h2><p>å¯¹äºéå¸¸å°‘è¡Œä¸ºçš„å†…å®¹ï¼ˆlow-funnel contentï¼‰ï¼Œå®æ—¶å­¦ä¹ çš„å¬å›æ¨¡å‹æ•ˆæœå¹¶ä¸å¥½ï¼Œå¯¹äºæœ‰å°‘é‡è¡Œä¸ºçš„å†…å®¹ï¼ˆmiddle-funnel contentï¼‰åˆ™å¯ä»¥è¾¾åˆ°æ›´å¥½çš„ä¸ªæ€§åŒ–å’Œç›¸å…³æ€§ï¼Œç›¸æ¯”äºåœ¨ä¸€è·¯å¬å›ä¸­åŒæ—¶æå‡æ³›åŒ–æ€§å’Œç›¸å…³æ€§ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸€ä¸ªå¤šé€šé“å¬å›çš„æ–¹æ¡ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º,åŒæ—¶ä¸ºäº†é™ä½ç³»ç»Ÿè´Ÿè½½ï¼Œä»¥æ¦‚ç‡p%æ¥é€‰æ‹©å…¶ä¸­æŸä¸€ä¸ªé€šé“è¿›è¡Œå¬å›ã€‚</p>
<p><img src="./multi-funnel_nomination.png" alt="multi-funnel_nomination"></p>
<p>å®éªŒç»“æœå¦‚ä¸‹ï¼š</p>
<ol>
<li>ç›¸æ¯”äºå•çº¯åŒå¡”æ¨¡å‹ï¼Œå®æ—¶å­¦ä¹ çš„åŒå¡”å—æµè¡Œçƒ­é—¨å½±å“è¾ƒå¤§ï¼Œæ›å…‰å‘å¤´éƒ¨é›†ä¸­ï¼ˆfig8 leftï¼‰ï¼Œå¤šé€šé“å¬å›åˆ™ä¼šæ›´å‡è¡¡ï¼ˆfig8 rightï¼‰</li>
<li>é•¿æœŸæ¥çœ‹ï¼Œå¤šé€šé“çš„å†…å®¹åŠ©æ¨æ•ˆæœä¼šæ›´å¥½ï¼ˆtable 1ï¼‰</li>
<li>ç”¨æˆ·æ€»åœç•™æ—¶é•¿å˜åŒ–ä¸å¤§ï¼ˆfig9 aï¼‰ï¼Œåœ¨æ–°å†…å®¹ä¸Šçš„åœç•™æ—¶é•¿å¢åŠ ï¼ˆfig9 bï¼‰ï¼Œ</li>
</ol>
<p><img src="./exp2_1.png" alt="exp2_1"></p>
<p><img src="./exp2_2.png" alt="exp2_2"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Recommendation-System/" rel="tag"># Recommendation System</a>
          
            <a href="/tags/Deep-Learning/" rel="tag"># Deep Learning</a>
          
            <a href="/tags/Fresh-Content/" rel="tag"># Fresh Content</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2023/07/01/Attention-is-all-you-need/" rel="next" title="Attention is all you need">
                <i class="fa fa-chevron-left"></i> Attention is all you need
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2023/08/06/Streaming-CTR-Prediction-Rethinking-Recommendation-Task-for-Real-World-Streaming-Data/" rel="prev" title="Streaming CTR Prediction: Rethinking Recommendation Task for Real-World Streaming Data">
                Streaming CTR Prediction: Rethinking Recommendation Task for Real-World Streaming Data <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="uyan_frame"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">113</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">56</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%91%98%E8%A6%81"><span class="nav-number">1.</span> <span class="nav-text">æ‘˜è¦</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%B0%E5%86%85%E5%AE%B9%E5%AD%B5%E5%8C%96%E9%93%BE%E8%B7%AF"><span class="nav-number">2.</span> <span class="nav-text">æ–°å†…å®¹å­µåŒ–é“¾è·¯</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%9A%E9%80%9A%E9%81%93%E6%96%B0%E5%86%85%E5%AE%B9%E6%8E%A8%E8%8D%90"><span class="nav-number">3.</span> <span class="nav-text">å¤šé€šé“æ–°å†…å®¹æ¨è</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E6%B3%9B%E5%8C%96"><span class="nav-number">3.1.</span> <span class="nav-text">å†…å®¹æ³›åŒ–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E6%97%B6%E5%AD%A6%E4%B9%A0"><span class="nav-number">3.2.</span> <span class="nav-text">å®æ—¶å­¦ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E9%80%9A%E9%81%93%E5%8F%AC%E5%9B%9E"><span class="nav-number">3.3.</span> <span class="nav-text">å¤šé€šé“å¬å›</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YuyangZhangFTD</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  
    

    
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2140861"></script>
      <!-- UY END -->
    
  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.2"></script>



  

  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  


  

  

</body>
</html>
