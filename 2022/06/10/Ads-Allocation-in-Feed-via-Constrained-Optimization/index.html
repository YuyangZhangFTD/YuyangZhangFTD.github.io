<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Advertising,Ad Allocation," />





  <link rel="alternate" href="/atom.xml" title="Arvin's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="TL;DR LinkedIn发表在KDD2020上的文章，主要想解决在信息流中，如何将自然推荐物品和广告进行混排的问题，文中将该问题建模为带约束的优化问题，并提出了一种归并排序的方式。 目前这种方法及其衍生版本、简化版本，在日常工作中都非常常见，基本可以作为自然推荐和广告混排问题的baseline solution了。 摘要  Social networks and content publish">
<meta property="og:type" content="article">
<meta property="og:title" content="Ads Allocation in Feed via Constrained Optimization">
<meta property="og:url" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/index.html">
<meta property="og:site_name" content="Arvin&#39;s Blog">
<meta property="og:description" content="TL;DR LinkedIn发表在KDD2020上的文章，主要想解决在信息流中，如何将自然推荐物品和广告进行混排的问题，文中将该问题建模为带约束的优化问题，并提出了一种归并排序的方式。 目前这种方法及其衍生版本、简化版本，在日常工作中都非常常见，基本可以作为自然推荐和广告混排问题的baseline solution了。 摘要  Social networks and content publish">
<meta property="og:locale">
<meta property="og:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/1.jpg">
<meta property="og:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/2.jpg">
<meta property="og:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/3.jpg">
<meta property="og:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/4.jpg">
<meta property="og:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/5.jpg">
<meta property="og:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/6.jpg">
<meta property="og:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/7.jpg">
<meta property="og:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/8.jpg">
<meta property="og:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/9.jpg">
<meta property="article:published_time" content="2022-06-10T14:38:43.000Z">
<meta property="article:modified_time" content="2022-06-11T10:55:54.057Z">
<meta property="article:author" content="YuyangZhangFTD">
<meta property="article:tag" content="Advertising">
<meta property="article:tag" content="Ad Allocation">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/"/>





  <title>Ads Allocation in Feed via Constrained Optimization | Arvin's Blog</title>
  














<meta name="generator" content="Hexo 5.4.2"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Arvin's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Poem & Algorithm</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/06/10/Ads-Allocation-in-Feed-via-Constrained-Optimization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Arvin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Ads Allocation in Feed via Constrained Optimization</h1>
        

        <div class="post-meta">
          

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-06-10T22:38:43+08:00">
                2022-06-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PaperNote/" itemprop="url" rel="index">
                    <span itemprop="name">PaperNote</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>TL;DR</p>
<p>LinkedIn发表在KDD2020上的文章，主要想解决在信息流中，如何将自然推荐物品和广告进行混排的问题，文中将该问题建模为带约束的优化问题，并提出了一种归并排序的方式。</p>
<p>目前这种方法及其衍生版本、简化版本，在日常工作中都非常常见，基本可以作为自然推荐和广告混排问题的baseline solution了。</p>
<h1 id="摘要">摘要</h1>
<blockquote>
<p>Social networks and content publishing platforms have newsfeed applications, which show both organic content to drive engagement, and ads to drive revenue. This paper focuses on the problem of ads allocation in a newsfeed to achieve an optimal balance of revenue and engagement. To the best of our knowledge, we are the first to report practical solutions to this business-critical and popular problem in industry.</p>
<p>The paper describes how large-scale recommender system like feed ranking works, and why it is useful to consider ads allocation as a post-operation once the ranking of organic items and (separately) the ranking of ads are done. A set of computationally lightweight algorithms are proposed based on various sets of assumptions in the context of ads on the LinkedIn newsfeed. Through both offline simulation and online A/B tests, benefits of the proposed solutions are demonstrated. The best performing algorithm is currently fully deployed on the LinkedIn newsfeed and is serving all live traffic.</p>
</blockquote>
<p>社交网络平台和内容平台都有信息流的产品，其中既有能够促进用户参与停留的自然推荐的内容，也有为平台贡献收益的广告内容。本文重点讨论了在信息流中广告分配问题，以实现收入和参与度的最佳平衡。据我们所知，对于这个显著影响业务收益且广泛存在的问题，本文首次提出了一种实际可用的解决方案。</p>
<p>本文描述了信息流排序这种大型的推荐系统是如何工作的，并且解释了在自然推荐物品和广告物品各自排序后将广告分配视作一种后处理操作，这个方案为什么是用的。在LinkedIn的信息流产品上，基于多种假设提出了一套轻量级的算法，并通过离线模拟和在线AB测试，证明了所提出的方案是有正向效果的。目前表现最好的算法已经被部署并在LinkedIn的信息流产品上全量使用。</p>
<h1 id="问题背景">问题背景</h1>
<p>信息流推荐是一种常见的产品，为用户展示一些与其相关的内容，包括朋友以及关注用户的博文更新、公司的新闻、社团的活动或是工作的招聘信息。我们将创作者不需要付费就可以展示内容称为自然内容（organic content，下文中称自然推荐物品）。因为更感兴趣，用户会更原因浏览这些内容，进而在平台上有更高的参与度（engagement，也可以理解为平台上停留意愿）。</p>
<p>同时，商业化也是大部分社交网络平台需要重点考虑的事情之一，常见做法是将广告插入自然推荐中。这些广告可以帮助广告主触达其目标用户进而获得更高利润，同时也能帮助平台获得商业收益的回报。目前只有很少的工作在研究应该在页面头部插入多少搜索广告。</p>
<p>据我们所知，目前还没有人研究如何确定信息流推荐中广告的位置，以及现实应用场景中的有效性。这个问题相比搜索广告更加复杂，因为推荐广告可以插入在任意位置。同时，社交网络平台风靡全球，在其信息流推荐中如何实现商业化是非常重要的问题，这也是我们这个工作所关注的。</p>
<p>自然推荐主要目标是最大化用户参与度，如各种用户的行为，广告则是通过竞价排序最大化期望收益。这两类物品的效用以及目标不同，导致了当前推荐排序系统往往是两层结构：相互独立的排序子路和多路召回（此处指不同类型的推荐召回）合并的混排。</p>
<p>混排的多路召回的子路往往有不同的目标，广告很难会比自然推荐带来更高的参与度，如何分配信息流中的曝光来平衡参与度与收益，正是我们想要解决的问题。一个常用的简单方案是采用定坑，在确定的坑位中透出广告商品。毫无疑问，定坑的方式是有损效率的，下图是一个case。</p>
<figure>
<img src="1.jpg" alt="Fixed Slot" /><figcaption aria-hidden="true">Fixed Slot</figcaption>
</figure>
<p>在混排中，如果想将不同目标的子路召回排序进行合并，就需要效用间的转化系数，某些情况下，可以直接采用商业价值进行折算，比如一个点击等同于1美元。我们也考虑了另外的方式，约束优化问题建模，这种方式并不直接给出一个转化系数，而是通过限定效用量来进行分配，得到最优解时的对偶变量即转化系数。</p>
<h1 id="解决方案">解决方案</h1>
<p>常见的系统架构如下</p>
<figure>
<img src="2.jpg" alt="System" /><figcaption aria-hidden="true">System</figcaption>
</figure>
<p>其中自然推荐排序一般以用户活跃度优化为目标，广告排序一般以收入为目标，在CPC模式中一般采用<span class="math inline">\(\text{bid}\times\text{pCTR}\)</span>进行排序，二价排序竞价扣费。混排层作为最后的重排，一般要求：</p>
<ol type="1">
<li>低延迟，子路的排序往往是耗时的大头</li>
<li>子路保序，即不改变推荐子路或者广告子路的序，除了效率因素外，广告一般采用GSP竞价，改变序之后会改变扣费</li>
<li>建模速度，因为推荐和广告往往是分不同团队在迭代，所以需要设计成两阶段的排序，同时系统需要自适应不同子路模型的迭代，自动调整混排中的参数</li>
</ol>
<p>为了保护用户的体验，避免广告扎堆出现，需要设置一些规则。文中提出了top slot和min gap两个规则，top slot指第几个坑位之后才能出广告，min gap指出广告之后，至少需要间隔多少个自然推荐物品。</p>
<p>同时我们希望混排层还具备：</p>
<ul>
<li>对于季节性自适应，广告需求往往有季节或者年的周期性变化，混排应该根据收益的系统性变化来调整广告的曝光量</li>
<li>动态广告位置，如果广告只在固定的位置出现，用户可能会有意回避，造成收益的损失。</li>
</ul>
<p>曝光的下标为<span class="math inline">\(i\)</span>，请求的下标为<span class="math inline">\(j\)</span>，自然推荐物品的期望参与效用<span class="math inline">\(u_i^o\)</span>，广告的期望参与效用<span class="math inline">\(u_i^a\)</span>（此处的效用可以理解为点击物品），广告期望收益效用<span class="math inline">\(r_i^a\)</span>，自然推荐物品的期望收益效用为<span class="math inline">\(r_i^o=0\)</span>。对于共<span class="math inline">\(\mathcal{J}\)</span>请求，每次请求<span class="math inline">\(j\)</span>都有<span class="math inline">\(N_j^o\)</span>个自然推荐候选和<span class="math inline">\(N_j^a\)</span>个广告候选，<span class="math inline">\(N_j=N_j^o+N_j^a\)</span>。自然推荐子路根据<span class="math inline">\(\bf{u}^o\)</span>进行排序，广告子路根据<span class="math inline">\(\bf{r}^a\)</span>进行排序，对于每个曝光坑位<span class="math inline">\(i\)</span>，<span class="math inline">\(x_i\)</span>表示是否放置广告，问题定义为 <span class="math display">\[
\begin{aligned}
\max &amp;&amp; \sum_i x_i r_i -\frac{w}{2}\|{\bf{x}}\|^2 
\\
\text{s.t.} &amp;&amp; \sum_i x_i u_i^a +(1-x_i)u_i^o \geq C 
\\
&amp;&amp; 0\leq x_i \leq 1, \forall i\in\mathcal{I}
\end{aligned}
\]</span> 在全部参与大于等于某个常量基础下，最大化总体收益，目标函数中的二次项是为了保证整个问题的凸性。使用拉格朗日对偶，最优解为 <span class="math display">\[
x_i=\begin{cases}
1, &amp;&amp; \text{if} \quad r_i^a +\alpha u_i^a - \alpha u_i^o &gt; 0
\\
0, &amp;&amp; \text{otherwise}
\end{cases}
\]</span> 其中参数<span class="math inline">\(\alpha\)</span>即最优的拉格朗日对偶变量。整个排序算法如下</p>
<figure>
<img src="3.jpg" alt="Re-Ranker" /><figcaption aria-hidden="true">Re-Ranker</figcaption>
</figure>
<p>整体逻辑是，自然推荐和广告进行归并排序，根据公式确定<span class="math inline">\(x_i\)</span>取值，即对应坑位出广告还是自然推荐商品。</p>
<p>获取影子价格系数<span class="math inline">\(\alpha\)</span>一般有三种方式：</p>
<ol type="1">
<li>给定<span class="math inline">\(C\)</span>后，用历史数据求解出最优解</li>
<li>在线AB测试选出合适的系数</li>
<li>离线回放仿真，后文会解释。</li>
</ol>
<p>在信息流排序中，往往会存在位置的偏差，顶部的商品更容易被点击。常见的解决方法是将位置信息作为特征加入模型训练，并且在线上推断时采用一个默认值。此处我们假设位置偏差对于自然推荐和广告无异质性，同时满足非递增。</p>
<p>对于出广告的间隔（Gap），由于位置偏差存在，很难直接估计。我们做了若干随机试验后，做了如下统计，其中<span class="math inline">\(d=k&#39;-k\)</span>，即在<span class="math inline">\(k\)</span>和<span class="math inline">\(k&#39;\)</span>位置出广告</p>
<figure>
<img src="4.jpg" alt="Ads CTR with Gap" /><figcaption aria-hidden="true">Ads CTR with Gap</figcaption>
</figure>
<p>广告的CTR在比较小的gap下降低较多，但是对于自然推荐，并没有这个现象。所以在广告中我们采用与位置偏差相同的方式考虑gap的影响。</p>
<p>广告的CTR模型为 <span class="math display">\[
g\big(\mathbb{E}[y_{iu}]\big)={\bf{a}}_{iu}^\intercal {\bf{z}}_{iu} + {\bf{b}}_i^\intercal {\bf{v}}_i
\]</span> 其中<span class="math inline">\(g(y)\)</span>是概率的logit，<span class="math inline">\({\bf{a}}_{iu}\)</span>是用户和商品的所有特征，<span class="math inline">\({\bf{b}}_i\)</span>是物品相关的ID特征。我们在此基础上增加gap特征<span class="math inline">\(d\)</span> <span class="math display">\[
g\big(\mathbb{E}[y_{iu|d}]\big)={\bf{a}}_{iu}^\intercal {\bf{z}}_{iu} + {\bf{b}}_i^\intercal {\bf{v}}_i +\beta d
\]</span> 那么间隔的影响为 <span class="math display">\[
\begin{aligned}
g\big(\mathbb{E}[y_{iu|d}]\big)&amp;=
\frac{1}{
1+\exp\big(-g(y_{iu|d})\big)
}
\\
&amp;=\frac{1}{
1+\exp\big(-g(y_{iu})\big)
}\theta_d
\\
\theta_d&amp;=\frac{1+\exp\big(-g(y_{iu})\big)}{1+\exp\big(-g(y_{iu|d})\big)}
\\
&amp;\approx \frac{\exp\big(-g(y_{iu})\big)}{\exp\big(-g(y_{iu|d})\big)}
\\
&amp;=\exp(\beta d)
\end{aligned}
\]</span> 间隔<span class="math inline">\(d\)</span>下，广告的混排打分为<span class="math inline">\(\text{score}(i|d)=\theta_d (r_i+\alpha u_i^a)\)</span>，同时自然打分不变。</p>
<figure>
<img src="5.jpg" alt="Re-Ranker with Gap Effect" /><figcaption aria-hidden="true">Re-Ranker with Gap Effect</figcaption>
</figure>
<p>一个很自然的想法是做个性化的间隔效应估计，<span class="math inline">\(\theta_{ud}=\exp({\bf{c}}_{ud}^\intercal {\bf{\beta}}_{ud})\)</span>，但这种做法会增加计算时间，需要增加广告数量*位置数量次的计算。</p>
<h1 id="实验分析">实验分析</h1>
<p>离线评估，定义折扣累计收益<span class="math inline">\(\text{score}(R)=\sum_j\sum_k w_k r_{k,j}\)</span>，折扣累积参与度<span class="math inline">\(\text{score}(E)=\sum_j\sum_k w_k u_{k,j}\)</span>，其中位置权重为<span class="math inline">\(w_k=\frac{1}{\log_2(k+1)}\)</span>，通过调整<span class="math inline">\(\alpha\)</span>，我们可以得到帕累托最优的等效面。</p>
<figure>
<img src="6.jpg" alt="DCG" /><figcaption aria-hidden="true">DCG</figcaption>
</figure>
<p>我们发现gap为0时候，效果最好，这是因为在原有评估指标中，并没有考虑到gap的影响，假设不同位置间独立，所以我们采用考虑gap影响的折扣累积收益 <span class="math display">\[
\text{score}(R)=\sum_j\sum_k \frac{r_{k,j}}{\log_2(k+1)}\log_{10}(d+c)
\]</span> <span class="math inline">\(log_{10}(d+c)\)</span>是根据随机实验中评估的折损效率进行拟合。</p>
<figure>
<img src="7.jpg" alt="Modified DCG" /><figcaption aria-hidden="true">Modified DCG</figcaption>
</figure>
<p>在线评估如下图所示，相比不考虑Gap效应时，相同<span class="math inline">\(\beta\)</span>和不同<span class="math inline">\(\alpha\)</span>下，收益和参与度都有不同程度的提升</p>
<figure>
<img src="8.jpg" alt="Online Exp" /><figcaption aria-hidden="true">Online Exp</figcaption>
</figure>
<p>与此同时，在考虑Gap效应的混排中，广告会被放在更多不同的位置上，有70%的用户被施加了超过一种的Gap，旧算法只有40%，所以可以降低用户的“无视广告习惯”的影响</p>
<p>在广告系统中，广告需求存在周期性，较高需求时，收益的期望会更高，需求较低时，收益的追求降低，如下图所示，广告需求少时，整体排序位置会更靠后，广告需求多时，广告排序位置会更靠前。</p>
<figure>
<img src="9.jpg" alt="Elasticity to Demand" /><figcaption aria-hidden="true">Elasticity to Demand</figcaption>
</figure>
<p>因为自然推荐和广告是由不同的系统产出，所以各种排序分数需要可比，所以对其分别进行校准。对于点估计采用保序回归进行校准，对于多个点估计相乘的情况，采用Thompson采样来寻找全局的校准因子。</p>
<h1 id="总结">总结</h1>
<p>本文是少有的写混排的文章，思路比较简单，以收益为目标，降低流量效率作为损失，进行归并混排。本文的一个亮点是对于广告商品间隔影响的考虑，这个在部分混排场景中并不常见，比如电商端内推荐广告就不存在这个问题，与之类似的问题是打散窗口的设计（比如一屏幕6个商品不能有同类目的）。除此之外，文章对于实践指导意义比较强，写了很多能落地的东西，这也是LinkedIn文章一贯的特点，非常务实。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Advertising/" rel="tag"># Advertising</a>
          
            <a href="/tags/Ad-Allocation/" rel="tag"># Ad Allocation</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/06/06/Bid-Optimization-by-Multivariable-Control-in-Display-Advertising/" rel="next" title="Bid Optimization by Multivariable Control in Display Advertising">
                <i class="fa fa-chevron-left"></i> Bid Optimization by Multivariable Control in Display Advertising
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/06/18/A-Unified-Solution-to-Constrained-Bidding-in-Online-Display-Advertising/" rel="prev" title="A Unified Solution to Constrained Bidding in Online Display Advertising">
                A Unified Solution to Constrained Bidding in Online Display Advertising <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="uyan_frame"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">113</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">56</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%91%98%E8%A6%81"><span class="nav-number">1.</span> <span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF"><span class="nav-number">2.</span> <span class="nav-text">问题背景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">3.</span> <span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E5%88%86%E6%9E%90"><span class="nav-number">4.</span> <span class="nav-text">实验分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YuyangZhangFTD</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  
    

    
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2140861"></script>
      <!-- UY END -->
    
  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.2"></script>



  

  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  


  

  

</body>
</html>
